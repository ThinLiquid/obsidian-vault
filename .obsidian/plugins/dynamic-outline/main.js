/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var lt=Object.create;var be=Object.defineProperty;var ot=Object.getOwnPropertyDescriptor;var ct=Object.getOwnPropertyNames;var ut=Object.getPrototypeOf,gt=Object.prototype.hasOwnProperty;var dt=(p,e)=>()=>(e||p((e={exports:{}}).exports,e),e.exports),ht=(p,e)=>{for(var i in e)be(p,i,{get:e[i],enumerable:!0})},qe=(p,e,i,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of ct(e))!gt.call(p,s)&&s!==i&&be(p,s,{get:()=>e[s],enumerable:!(n=ot(e,s))||n.enumerable});return p};var pt=(p,e,i)=>(i=p!=null?lt(ut(p)):{},qe(e||!p||!p.__esModule?be(i,"default",{value:p,enumerable:!0}):i,p)),mt=p=>qe(be({},"__esModule",{value:!0}),p);var $e=dt((Ke,He)=>{((p,e)=>{typeof define=="function"&&define.amd?define([],e):typeof He=="object"&&He.exports?He.exports=e():p.fuzzysort=e()})(Ke,p=>{"use strict";var e=(a,t)=>{if(!a||!t)return C;var r=G(a);J(t)||(t=N(t));var c=r.bitflags;return(c&t._bitflags)!==c?C:ne(r,t)},i=(a,t,r)=>{if(!a)return r!=null&&r.all?Fe(t,r):Ve;var c=G(a),u=c.bitflags,o=c.containsSpace,l=R((r==null?void 0:r.threshold)||0),d=(r==null?void 0:r.limit)||ke,g=0,v=0,w=t.length;function V(Q){g<d?(Ee.add(Q),++g):(++v,Q._score>Ee.peek()._score&&Ee.replaceTop(Q))}if(r!=null&&r.key)for(var D=r.key,y=0;y<w;++y){var x=t[y],E=ye(x,D);if(E&&(J(E)||(E=N(E)),(u&E._bitflags)===u)){var b=ne(c,E);b!==C&&(b._score<l||(b.obj=x,V(b)))}}else if(r!=null&&r.keys){var $=r.keys,F=$.length;e:for(var y=0;y<w;++y){var x=t[y];{for(var I=0,_=0;_<F;++_){var D=$[_],E=ye(x,D);if(!E){xe[_]=se;continue}J(E)||(E=N(E)),xe[_]=E,I|=E._bitflags}if((u&I)!==u)continue}if(o)for(let L=0;L<c.spaceSearches.length;L++)z[L]=B;for(var _=0;_<F;++_){if(E=xe[_],E===se){ae[_]=se;continue}if(ae[_]=ne(c,E,!1,o),ae[_]===C){ae[_]=se;continue}if(o)for(let H=0;H<c.spaceSearches.length;H++){if(Y[H]>-1e3&&z[H]>B){var O=(z[H]+Y[H])/4;O>z[H]&&(z[H]=O)}Y[H]>z[H]&&(z[H]=Y[H])}}if(o){for(let L=0;L<c.spaceSearches.length;L++)if(z[L]===B)continue e}else{var f=!1;for(let L=0;L<F;L++)if(ae[L]._score!==B){f=!0;break}if(!f)continue}var A=new T(F);for(let L=0;L<F;L++)A[L]=ae[L];if(o){var M=0;for(let L=0;L<c.spaceSearches.length;L++)M+=z[L]}else{var M=B;for(let H=0;H<F;H++){var b=A[H];if(b._score>-1e3&&M>B){var O=(M+b._score)/4;O>M&&(M=O)}b._score>M&&(M=b._score)}}if(A.obj=x,A._score=M,r!=null&&r.scoreFn){if(M=r.scoreFn(A),!M)continue;M=R(M),A._score=M}M<l||V(A)}}else for(var y=0;y<w;++y){var E=t[y];if(E&&(J(E)||(E=N(E)),(u&E._bitflags)===u)){var b=ne(c,E);b!==C&&(b._score<l||V(b))}}if(g===0)return Ve;for(var U=new Array(g),y=g-1;y>=0;--y)U[y]=Ee.poll();return U.total=g+v,U},n=(a,t="<b>",r="</b>")=>{for(var c=typeof t=="function"?t:void 0,u=a.target,o=u.length,l=a.indexes,d="",g=0,v=0,w=!1,V=[],D=0;D<o;++D){var y=u[D];if(l[v]===D){if(++v,w||(w=!0,c?(V.push(d),d=""):d+=t),v===l.length){c?(d+=y,V.push(c(d,g++)),d="",V.push(u.substr(D+1))):d+=y+r+u.substr(D+1);break}}else w&&(w=!1,c?(V.push(c(d,g++)),d=""):d+=r);d+=y}return c?V:d},s=a=>{typeof a=="number"?a=""+a:typeof a!="string"&&(a="");var t=Oe(a);return k(a,{_targetLower:t._lower,_targetLowerCodes:t.lowerCodes,_bitflags:t.bitflags})},h=()=>{De.clear(),Ie.clear()};class m{get indexes(){return this._indexes.slice(0,this._indexes.len).sort((t,r)=>t-r)}set indexes(t){return this._indexes=t}highlight(t,r){return n(this,t,r)}get score(){return te(this._score)}set score(t){this._score=R(t)}}class T extends Array{get score(){return te(this._score)}set score(t){this._score=R(t)}}var k=(a,t)=>{var c,u,o,l,d,g,v;let r=new m;return r.target=a,r.obj=(c=t.obj)!=null?c:C,r._score=(u=t._score)!=null?u:B,r._indexes=(o=t._indexes)!=null?o:[],r._targetLower=(l=t._targetLower)!=null?l:"",r._targetLowerCodes=(d=t._targetLowerCodes)!=null?d:C,r._nextBeginningIndexes=(g=t._nextBeginningIndexes)!=null?g:C,r._bitflags=(v=t._bitflags)!=null?v:0,r},te=a=>a===B?0:a>1?a:Math.E**(((-a+1)**.04307-1)*-2),R=a=>a===0?B:a>1?a:1-Math.pow(Math.log(a)/-2+1,1/.04307),ie=a=>{typeof a=="number"?a=""+a:typeof a!="string"&&(a=""),a=a.trim();var t=Oe(a),r=[];if(t.containsSpace){var c=a.split(/\s+/);c=[...new Set(c)];for(var u=0;u<c.length;u++)if(c[u]!==""){var o=Oe(c[u]);r.push({lowerCodes:o.lowerCodes,_lower:c[u].toLowerCase(),containsSpace:!1})}}return{lowerCodes:t.lowerCodes,_lower:t._lower,containsSpace:t.containsSpace,bitflags:t.bitflags,spaceSearches:r}},N=a=>{if(a.length>999)return s(a);var t=De.get(a);return t!==void 0||(t=s(a),De.set(a,t)),t},G=a=>{if(a.length>999)return ie(a);var t=Ie.get(a);return t!==void 0||(t=ie(a),Ie.set(a,t)),t},Fe=(a,t)=>{var r=[];r.total=a.length;var c=(t==null?void 0:t.limit)||ke;if(t!=null&&t.key)for(var u=0;u<a.length;u++){var o=a[u],l=ye(o,t.key);if(l!=C){J(l)||(l=N(l));var d=k(l.target,{_score:l._score,obj:o});if(r.push(d),r.length>=c)return r}}else if(t!=null&&t.keys)for(var u=0;u<a.length;u++){for(var o=a[u],g=new T(t.keys.length),v=t.keys.length-1;v>=0;--v){var l=ye(o,t.keys[v]);if(!l){g[v]=se;continue}J(l)||(l=N(l)),l._score=B,l._indexes.len=0,g[v]=l}if(g.obj=o,g._score=B,r.push(g),r.length>=c)return r}else for(var u=0;u<a.length;u++){var l=a[u];if(l!=C&&(J(l)||(l=N(l)),l._score=B,l._indexes.len=0,r.push(l),r.length>=c))return r}return r},ne=(a,t,r=!1,c=!1)=>{if(r===!1&&a.containsSpace)return it(a,t,c);for(var u=a._lower,o=a.lowerCodes,l=o[0],d=t._targetLowerCodes,g=o.length,v=d.length,y=0,w=0,V=0;;){var D=l===d[w];if(D){if(q[V++]=w,++y,y===g)break;l=o[y]}if(++w,w>=v)return C}var y=0,x=!1,E=0,b=t._nextBeginningIndexes;b===C&&(b=t._nextBeginningIndexes=at(t.target)),w=q[0]===0?0:b[q[0]-1];var $=0;if(w!==v)for(;;)if(w>=v){if(y<=0||(++$,$>200))break;--y;var F=we[--E];w=b[F]}else{var D=o[y]===d[w];if(D){if(we[E++]=w,++y,y===g){x=!0;break}++w}else w=b[w]}var I=g<=1?-1:t._targetLower.indexOf(u,q[0]),_=!!~I,O=_?I===0||t._nextBeginningIndexes[I-1]===I:!1;if(_&&!O){for(var f=0;f<b.length;f=b[f])if(!(f<=I)){for(var A=0;A<g&&o[A]===t._targetLowerCodes[f+A];A++);if(A===g){I=f,O=!0;break}}}var M=L=>{for(var H=0,We=0,K=1;K<g;++K)L[K]-L[K-1]!==1&&(H-=L[K],++We);var st=L[g-1]-L[0]-(g-1);if(H-=(12+st)*We,L[0]!==0&&(H-=L[0]*L[0]*.2),!x)H*=1e3;else{for(var Be=1,K=b[0];K<v;K=b[K])++Be;Be>24&&(H*=(Be-24)*10)}return H-=(v-g)/2,_&&(H/=1+g*g*1),O&&(H/=1+g*g*1),H-=(v-g)/2,H};if(x)if(O){for(var f=0;f<g;++f)q[f]=I+f;var U=q,Q=M(q)}else var U=we,Q=M(we);else{if(_)for(var f=0;f<g;++f)q[f]=I+f;var U=q,Q=M(U)}t._score=Q;for(var f=0;f<g;++f)t._indexes[f]=U[f];t._indexes.len=g;let Le=new m;return Le.target=t.target,Le._score=t._score,Le._indexes=t._indexes,Le},it=(a,t,r)=>{for(var c=new Set,u=0,o=C,l=0,d=a.spaceSearches,g=d.length,v=0,w=()=>{for(let O=v-1;O>=0;O--)t._nextBeginningIndexes[_e[O*2+0]]=_e[O*2+1]},V=!1,_=0;_<g;++_){Y[_]=B;var D=d[_];if(o=ne(D,t),r){if(o===C)continue;V=!0}else if(o===C)return w(),C;var y=_===g-1;if(!y){var x=o._indexes,E=!0;for(let f=0;f<x.len-1;f++)if(x[f+1]-x[f]!==1){E=!1;break}if(E){var b=x[x.len-1]+1,$=t._nextBeginningIndexes[b-1];for(let f=b-1;f>=0&&$===t._nextBeginningIndexes[f];f--)t._nextBeginningIndexes[f]=b,_e[v*2+0]=f,_e[v*2+1]=$,v++}}u+=o._score/g,Y[_]=o._score/g,o._indexes[0]<l&&(u-=(l-o._indexes[0])*2),l=o._indexes[0];for(var F=0;F<o._indexes.len;++F)c.add(o._indexes[F])}if(r&&!V)return C;w();var I=ne(a,t,!0);if(I!==C&&I._score>u){if(r)for(var _=0;_<g;++_)Y[_]=I._score/g;return I}r&&(o=t),o._score=u;var _=0;for(let O of c)o._indexes[_++]=O;return o._indexes.len=_,o},Ne=a=>a.replace(/\p{Script=Latin}+/gu,t=>t.normalize("NFD")).replace(/[\u0300-\u036f]/g,""),Oe=a=>{a=Ne(a);for(var t=a.length,r=a.toLowerCase(),c=[],u=0,o=!1,l=0;l<t;++l){var d=c[l]=r.charCodeAt(l);if(d===32){o=!0;continue}var g=d>=97&&d<=122?d-97:d>=48&&d<=57?26:d<=127?30:31;u|=1<<g}return{lowerCodes:c,bitflags:u,containsSpace:o,_lower:r}},nt=a=>{for(var t=a.length,r=[],c=0,u=!1,o=!1,l=0;l<t;++l){var d=a.charCodeAt(l),g=d>=65&&d<=90,v=g||d>=97&&d<=122||d>=48&&d<=57,w=g&&!u||!o||!v;u=g,o=v,w&&(r[c++]=l)}return r},at=a=>{a=Ne(a);for(var t=a.length,r=nt(a),c=[],u=r[0],o=0,l=0;l<t;++l)u>l?c[l]=u:(u=r[++o],c[l]=u===void 0?t:u);return c},De=new Map,Ie=new Map,q=[],we=[],_e=[],z=[],Y=[],xe=[],ae=[],ye=(a,t)=>{var r=a[t];if(r!==void 0)return r;if(typeof t=="function")return t(a);var c=t;Array.isArray(t)||(c=t.split("."));for(var u=c.length,o=-1;a&&++o<u;)a=a[c[o]];return a},J=a=>typeof a=="object"&&typeof a._bitflags=="number",ke=1/0,B=-ke,Ve=[];Ve.total=0;var C=null,se=s(""),rt=a=>{var t=[],r=0,c={},u=o=>{for(var l=0,d=t[l],g=1;g<r;){var v=g+1;l=g,v<r&&t[v]._score<t[g]._score&&(l=v),t[l-1>>1]=t[l],g=1+(l<<1)}for(var w=l-1>>1;l>0&&d._score<t[w]._score;w=(l=w)-1>>1)t[l]=t[w];t[l]=d};return c.add=o=>{var l=r;t[r++]=o;for(var d=l-1>>1;l>0&&o._score<t[d]._score;d=(l=d)-1>>1)t[l]=t[d];t[l]=o},c.poll=o=>{if(r!==0){var l=t[0];return t[0]=t[--r],u(),l}},c.peek=o=>{if(r!==0)return t[0]},c.replaceTop=o=>{t[0]=o,u()},c},Ee=rt();return{single:e,go:i,prepare:s,cleanup:h}})});var ft={};ht(ft,{BUTTON_CLASS:()=>Me,LUCID_ICON_NAME:()=>Ae,WINDOW_ID:()=>ee,default:()=>Te});module.exports=mt(ft);var re=require("obsidian");var Ge=require("obsidian");var Re=require("obsidian");var ze=require("obsidian"),le=class{constructor(e,i){this._plugin=e,this._view=i}get headings(){return this._getHeadingsForView(this._view)}updateView(e){this._view=e}_getHeadingsForView(e){var m;let i=e==null?void 0:e.file;if(!i)return[];let s=(m=(this._plugin.app.metadataCache.getFileCache(i)||{}).headings)!=null?m:[];return this._cleanupHeadings(s)}_cleanupHeadings(e){let i=h=>(0,ze.htmlToMarkdown)(h).replaceAll("*","").replaceAll("_","").replaceAll("`","").replaceAll("==","").replaceAll("~~",""),n=h=>h.replace(/\[([^\]]+)\]\(.*?\)/g,"$1").replace(/\[\[([^\]]+)\|([^\]]+)\]\]/g,"$2").replace(/\[\[([^\]]+)\]\]/g,"$1"),s=e;return s.forEach(h=>{let m=h.heading;m=i(m),m=n(m),h.heading=m}),s}};var X=class{constructor(e,i){this._plugin=e,i?(this.element=i,this.inputField=this.element.querySelector("input"),this.clearButton=this.element.querySelector(".dynamic-outline-search-clear-button")):(this.element=createEl("div",{cls:"dynamic-outline-search-container"}),this.inputField=createEl("input",{attr:{placeholder:"Search headings\u2026",type:"search"}}),this.element.appendChild(this.inputField),this.clearButton=createEl("div",{cls:"search-input-clear-button dynamic-outline-search-clear-button",attr:{"aria-label":"Clear search"}}),this.element.appendChild(this.clearButton),this.setupEventListeners())}setupEventListeners(){this._plugin.registerDomEvent(this.inputField,"input",()=>{this.handleInput()}),this._plugin.registerDomEvent(this.clearButton,"click",()=>{this.clearInput()})}clearInput(e=!0){this.inputField.value="";let i=new Event("input",{bubbles:!0,cancelable:!0});this.inputField.dispatchEvent(i),e&&this.inputField.focus()}handleInput(){this.inputField.value.length>0?(this.clearButton.classList.add("visible"),this.inputField.classList.add("has-content")):(this.clearButton.classList.remove("visible"),this.inputField.classList.remove("has-content"))}};var oe=class{constructor(e,i){this._plugin=e,this._view=i,this._stateManager=W.getInstance()}createLiElement(e,i=e.level){var m;let n=(m=this._plugin.getCssVariableAsNumber("--dynamic-outline-tab-size"))!=null?m:24,s=createEl("li",{attr:{"data-heading-line":e.position.start.line,style:`padding-left: ${(i-1)*n}px !important`}}),h=createEl("a",{cls:`heading-level-${e.level}`,text:e.heading});return s.append(h),this._setupEventListener(s,e),s}updateLiElementLine(e,i){e.setAttribute("data-heading-line",i.position.start.line.toString()),this._setupEventListener(e,i)}_setupEventListener(e,i){e.onclick=()=>{if(this._view.file){if(this._view.leaf.openFile(this._view.file,{eState:{line:i.position.start.line}}),setTimeout(()=>{this._view.currentMode.applyScroll(i.position.start.line)},0),this._plugin.settings.resetSearchFieldOnHeadingClick){let n=this._stateManager.getWindowInView(this._view),s=n.getContainerElement().querySelector(".dynamic-outline-search-container");if(!s)return;new X(this._plugin,s).clearInput(!1),n.removeHovered()}this._plugin.runCommand("editor:focus")}},e.addEventListener("mouseenter",()=>{e.classList.add("hovered")}),e.addEventListener("mouseleave",()=>{e.classList.remove("hovered")})}};var Ue=pt($e()),Z=class Z{constructor(e,i){this._latestHeadings=[];this._pinned=!1;this._plugin=e,this._view=i,this._stateManager=W.getInstance(),this._containerEl=this.createElement(),this._dynamicHeadings=new le(this._plugin,this._view),this.setupEventListeners()}get visible(){return!!this._view.containerEl.querySelector(`#${ee}`)}get pinned(){return this._pinned}set pinned(e){this._pinned=e,this._plugin.settings.toggleOnHover&&!e&&this.hide()}setupEventListeners(){this._plugin.registerDomEvent(this._containerEl.querySelector("input"),"input",()=>{this.filterItems()}),this._plugin.registerDomEvent(this._containerEl.querySelector("input"),"keydown",e=>{this.handleKeyDown(e)}),this._plugin.settings.toggleOnHover&&(this._plugin.registerDomEvent(this._containerEl,"mouseenter",()=>this.handleMouseEnter()),this._plugin.registerDomEvent(this._containerEl,"mouseleave",()=>this.handleMouseLeave()))}getVisibleLiItems(){return Array.from(this._containerEl.querySelectorAll("li:not(.outline-item-hidden"))}setHovered(e,i){e.forEach((n,s)=>{n.classList.toggle("hovered",s===i)})}handleKeyDown(e){let i=()=>{let T=n.findIndex(k=>k.classList.contains("hovered"));return T!==-1?T:n.findIndex(k=>k.classList.contains("highlight"))||0},n=this.getVisibleLiItems(),s=n.length,h=i(),m=h;switch(e.key){case"ArrowDown":case"Tab":e.preventDefault(),m=e.shiftKey?(h+s-1)%s:(h+1)%s;break;case"ArrowUp":e.preventDefault(),m=(h+s-1)%s;break;case"Enter":e.preventDefault(),h>=0&&n[h].click();break;case"Escape":e.preventDefault(),this.hide();break}m!==h&&(this.setHovered(n,m),n[m].scrollIntoView({block:"nearest"}))}filterItems(){let i=this._containerEl.querySelector("input").value.toLowerCase(),n=this._containerEl.querySelectorAll("li"),s;i===""?s=Array.from(n):s=Ue.go(i,Array.from(n),{key:"textContent"}).map(m=>m.obj),n.forEach(m=>{m.classList.toggle("outline-item-hidden",!s.includes(m))});let h=this.getVisibleLiItems();this.setHovered(h,0)}handleMouseEnter(){this.clearHideTimeout(),this.getVisibleLiItems().forEach(i=>{i.classList.remove("hovered")})}handleMouseLeave(){this._plugin.settings.toggleOnHover&&!this.pinned&&(Z.hideTimeout=setTimeout(()=>{this.hide()},100))}getContainerElement(){return this._containerEl}clearHideTimeout(){Z.hideTimeout&&(clearTimeout(Z.hideTimeout),Z.hideTimeout=null)}createElement(){let e=createEl("div",{attr:{id:"dynamic-outline"}}),i=new X(this._plugin);e.appendChild(i.element);let n=createEl("div",{cls:"dynamic-outline-content-container"});return n.createEl("ul",{}),e.appendChild(n),e}checkForObstructions(){let e=document.getElementById("cMenuToolbarModalBar"),i=e!==null&&e.classList.contains("top");this._containerEl.classList.toggle("obstruction-top",i)}checkForLocation(){this._containerEl.classList.toggle("location-left",this._plugin.settings.windowLocation==="left")}removeHovered(){this.getVisibleLiItems().forEach(i=>{i.classList.remove("hovered")})}updateView(e){this._view=e,this._dynamicHeadings.updateView(e)}highlightCurrentHeading(e="nearest"){let i=(k,te)=>{let R=0,ie=0,N=k.length-1;for(;ie<=N;){let G=Math.floor((ie+N)/2);k[G].position.start.line<=te?(R=G,ie=G+1):N=G-1}return R},n=this._view.currentMode.getScroll(),s=this.getHeadings();if(s.length==0)return;let h=i(s,n+1);this._containerEl.querySelectorAll("li").forEach((k,te)=>k.classList.toggle("highlight",te===h));let T=this._containerEl.querySelector("li.highlight");T==null||T.scrollIntoView({behavior:"instant",block:e})}getHeadings(){return this._dynamicHeadings.headings}update(){let e=(h,m)=>h.length===m.length&&h.every((T,k)=>T.heading===m[k].heading&&T.level===m[k].level),i=this._containerEl.querySelector("ul");if(!i)return;let n=new oe(this._plugin,this._view),s=this.getHeadings();if(s.length>0&&e(s,this._latestHeadings)){i.querySelectorAll("li").forEach((m,T)=>{n.updateLiElementLine(m,s[T])});return}if(this._latestHeadings=s,i.empty(),this._plugin.settings.dynamicHeadingIndentation){let h=[];s==null||s.forEach(m=>{for(;h.length>0&&m.level<=h[h.length-1];)h.pop();h.push(m.level);let T=n.createLiElement(m,h.length);i.append(T)})}else s==null||s.forEach(h=>{let m=n.createLiElement(h);i.append(m)});this._plugin.settings.highlightCurrentHeading&&this.highlightCurrentHeading()}show(e){if(this.visible)return;this.checkForObstructions(),this.checkForLocation(),this.update(),this._view.contentEl.append(this._containerEl);let i=this._stateManager.getButtonInView(this._view);if(i.active=!0,this._plugin.settings.autofocusSearchOnOpen){let n=this._containerEl.querySelector("input");n==null||n.focus()}this._plugin.settings.highlightCurrentHeading&&this.highlightCurrentHeading(e==null?void 0:e.scrollBlock)}hide(){if(!this.visible)return;this._containerEl.remove(),this.removeHovered();let e=this._stateManager.getButtonInView(this._view);e.active=!1,this._plugin.runCommand("editor:focus"),this._plugin.settings.toggleOnHover&&(this.pinned=!1)}toggle(){this.visible?this.hide():this.show()}};Z.hideTimeout=null;var j=Z;var ce=class{constructor(e){this._plugin=e,this._stateManager=W.getInstance(),this._containerEl=this.createElement(),this.setupEventListeners()}get visible(){return!!this._view.containerEl.querySelector(`button.${Me}`)}get active(){return this._containerEl.classList.contains("button-active")}set active(e){this._containerEl.classList.toggle("button-active",e)}setupEventListeners(){this._plugin.registerDomEvent(this._containerEl,"click",()=>this.handleClick()),this._plugin.settings.toggleOnHover&&(this._plugin.registerDomEvent(this._containerEl,"mouseenter",()=>this.handleMouseEnter()),this._plugin.registerDomEvent(this._containerEl,"mouseleave",()=>this.handleMouseLeave()))}createElement(){let e=createEl("button",{cls:`clickable-icon view-action ${Me}`,attr:{"aria-label":"Toggle Dynamic Outline"}});return(0,Re.setIcon)(e,Ae),e}handleMouseEnter(){let e=this._stateManager.getWindowInView(this._view);e.visible||e.show({scrollBlock:"start"}),this._plugin.settings.toggleOnHover&&e.clearHideTimeout()}handleMouseLeave(){let e=this._stateManager.getWindowInView(this._view);e.visible&&!e.pinned&&(j.hideTimeout=setTimeout(()=>{e.hide()},100))}getViewActionButtons(){return this._view.containerEl.querySelector(".view-actions")}getViewHeaderLeft(){return this._view.containerEl.querySelector(".view-header-left .view-header-nav-buttons")}updateView(e){this._view=e}handleClick(){let e=this._stateManager.getWindowInView(this._view);if(e.visible){if(this._plugin.settings.toggleOnHover)if(e.pinned)e.pinned=!1,e.clearHideTimeout();else{e.pinned=!0;return}e.hide()}else e.show({scrollBlock:"start"}),e.pinned=!0}show(){if(this.active=this.visible,this._plugin.settings.windowLocation==="right"){let e=this.getViewActionButtons();e&&e.insertBefore(this._containerEl,e==null?void 0:e.firstChild)}else if(this._plugin.settings.windowLocation==="left"){let e=this.getViewHeaderLeft();e&&e.appendChild(this._containerEl)}else console.error("Invalid window location")}hide(){this.visible&&this._containerEl.remove()}};var W=class p{constructor(e){this._windows=new Map;this._buttons=new Map;this._plugin=e}static initialize(e){return p.instance||(p.instance=new p(e)),p.instance}static getInstance(){if(!p.instance)throw new Error("OutlineStateManager not initialized");return p.instance}getKey(e){return e.leaf.id}getActiveMDView(){return this._plugin.app.workspace.getActiveViewOfType(Ge.MarkdownView)}getOpenMDViews(){return this._plugin.app.workspace.getLeavesOfType("markdown").map(i=>i.view)}getButtonInView(e){let i=this.getKey(e);this._buttons.has(i)||this._buttons.set(i,new ce(this._plugin));let n=this._buttons.get(i);return n.updateView(e),n}getWindowInView(e){let i=this.getKey(e);this._windows.has(i)||this._windows.set(i,new j(this._plugin,e));let n=this._windows.get(i);return n.updateView(e),n}handleFileOpen(){let e=this.getActiveMDView();if(!e)return;let i=this.getWindowInView(e),n=i.getHeadings(),s=n&&n.length>=this._plugin.settings.minimumHeadings;i.visible&&!s?(this._plugin.settings.toggleOnHover&&(i.pinned=!1),i.hide()):!i.visible&&s&&(setTimeout(()=>i.show(),50),this._plugin.settings.toggleOnHover&&(i.pinned=!0))}handleMetadataChanged(){let e=this.getActiveMDView();if(!e)return;this.getWindowInView(e).update()}createButtonsInOpenViews(){this.getOpenMDViews().forEach(e=>{if(e.leaf.width===0)return;let i=this.getButtonInView(e);i.visible||i.show()})}removeAll(){this._windows.forEach(e=>e.hide()),this._buttons.forEach(e=>e.hide()),this._windows.clear(),this._buttons.clear()}};var Ce=require("obsidian");var Ye=require("obsidian");var S=class{constructor(e,i){this.plugin=e,this.containerEl=i}};var ue=class extends S{display(){new Ye.Setting(this.containerEl).setName("Autofocus search field on open").setDesc("Focus the search field on window open. Useful for immediate keyboard control.").addToggle(e=>{e.setValue(this.plugin.settings.autofocusSearchOnOpen).onChange(async i=>{this.plugin.settings.autofocusSearchOnOpen=i,await this.plugin.saveSettings()})})}};var Je=require("obsidian");var ge=class extends S{display(){let e,i=this.plugin.settings.highlightCurrentHeading;new Je.Setting(this.containerEl).setName("Highlight active heading").setDesc(P("Highlight current outline heading while scrolling down the file.")).addButton(n=>{e=n,n.setButtonText("Reload plugin"),n.setTooltip("Requires a plugin reload to take effect."),n.setDisabled(!0),n.setClass("dynamic-outline-reload"),n.setCta(),n.onClick(()=>{this.plugin.reloadPlugin()})}).addToggle(n=>{n.setValue(this.plugin.settings.highlightCurrentHeading).onChange(async s=>{this.plugin.settings.highlightCurrentHeading=s,await this.plugin.saveSettings(),e.setDisabled(s===i)})})}};var Qe=require("obsidian");var de=class extends S{display(){new Qe.Setting(this.containerEl).setName("Style customization").setDesc(P('Please use the <a href="https://obsidian.md/plugins?id=obsidian-style-settings">Style Settings</a> plugin to customize the appearance of the Dynamic Outline.'))}};var Xe=require("obsidian");var he=class extends S{display(){new Xe.Setting(this.containerEl).setName("Reset search field on jump").setDesc("Erase the search field contents after clicking a heading.").addToggle(e=>{e.setValue(this.plugin.settings.resetSearchFieldOnHeadingClick).onChange(async i=>{this.plugin.settings.resetSearchFieldOnHeadingClick=i,await this.plugin.saveSettings()})})}};var Pe=require("obsidian");var pe=class extends S{display(){let e,i=this.plugin.settings.toggleAutomatically;new Pe.Setting(this.containerEl).setName("Toggle automatically").setDesc(P("Show and hide automatically based on the number of headings in the file.")).addButton(s=>{e=s,s.setButtonText("Reload plugin"),s.setTooltip("Requires a plugin reload to take effect."),s.setDisabled(!0),s.setClass("dynamic-outline-reload"),s.setCta(),s.onClick(()=>{this.plugin.reloadPlugin()})}).addToggle(s=>{s.setValue(this.plugin.settings.toggleAutomatically).onChange(async h=>{this.plugin.settings.toggleAutomatically=h,await this.plugin.saveSettings(),e.setDisabled(h===i),n.setDisabled(!h)})});let n=new Pe.Setting(this.containerEl).setName("Minimum headings").setDesc(P("The minimum number of headings in the file to trigger the outline.")).addSlider(s=>{s.setLimits(1,10,1).setDynamicTooltip().setValue(this.plugin.settings.minimumHeadings).onChange(async h=>{this.plugin.settings.minimumHeadings=h,await this.plugin.saveSettings()})}).setDisabled(!this.plugin.settings.toggleAutomatically)}};var Ze=require("obsidian");var me=class extends S{display(){let e,i=this.plugin.settings.toggleOnHover;new Ze.Setting(this.containerEl).setName("Toggle on hover").setDesc(P("Show and hide when hovering over the button, pin on click.")).addButton(n=>{e=n,n.setButtonText("Reload plugin"),n.setTooltip("Requires a plugin reload to take effect."),n.setDisabled(!0),n.setClass("dynamic-outline-reload"),n.setCta(),n.onClick(()=>{this.plugin.reloadPlugin()})}).addToggle(n=>{n.setValue(this.plugin.settings.toggleOnHover).onChange(async s=>{this.plugin.settings.toggleOnHover=s,await this.plugin.saveSettings(),e.setDisabled(s===i)})})}};var je=require("obsidian");var fe=class extends S{display(){let e,i=this.plugin.settings.windowLocation;new je.Setting(this.containerEl).setName("Window location").setDesc(P("Set the location both for window and button (right by default).")).addButton(n=>{e=n,n.setButtonText("Reload plugin"),n.setTooltip("Requires a plugin reload to take effect."),n.setDisabled(!0),n.setClass("dynamic-outline-reload"),n.setCta(),n.onClick(()=>{this.plugin.reloadPlugin()})}).addDropdown(n=>n.addOption("right","Right").addOption("left","Left").setValue(this.plugin.settings.windowLocation).onChange(async s=>{this.plugin.settings.windowLocation=s,await this.plugin.saveSettings(),e.setDisabled(s===i)}))}};var et=require("obsidian");var ve=class extends S{display(){let e,i=this.plugin.settings.dynamicHeadingIndentation;new et.Setting(this.containerEl).setName("Dynamic heading indentation").setDesc(P("Dynamically adjusts heading indentation based on the previous heading level, mimicking the Outline plugin's behavior for improved visual hierarchy.")).addButton(n=>{e=n,n.setButtonText("Reload plugin"),n.setTooltip("Requires a plugin reload to take effect."),n.setDisabled(!0),n.setClass("dynamic-outline-reload"),n.setCta(),n.onClick(()=>{this.plugin.reloadPlugin()})}).addToggle(n=>{n.setValue(this.plugin.settings.dynamicHeadingIndentation).onChange(async s=>{this.plugin.settings.dynamicHeadingIndentation=s,await this.plugin.saveSettings(),e.setDisabled(s===i)})})}};var tt={autofocusSearchOnOpen:!0,dynamicHeadingIndentation:!0,highlightCurrentHeading:!0,minimumHeadings:1,resetSearchFieldOnHeadingClick:!0,toggleAutomatically:!1,toggleOnHover:!1,windowLocation:"right"};function P(p){return(0,Ce.sanitizeHTMLToDom)(p)}var Se=class extends Ce.PluginSettingTab{constructor(e,i){super(e,i),this.plugin=i}display(){let{containerEl:e}=this;e.empty(),new ge(this.plugin,e).display(),new me(this.plugin,e).display(),new pe(this.plugin,e).display(),new ue(this.plugin,e).display(),new he(this.plugin,e).display(),new ve(this.plugin,e).display(),new fe(this.plugin,e).display(),new de(this.plugin,e).display()}};var ee="dynamic-outline",Me="dynamic-outline-button",Ae="list",Te=class extends re.Plugin{constructor(){super(...arguments);this.debounceHandler=(0,re.debounce)(i=>{let n=i.target;if(!(n!=null&&n.classList.contains("dynamic-outline-content-container"))){let s=this.stateManager.getActiveMDView();s&&this.stateManager.getWindowInView(s).highlightCurrentHeading()}},0)}async onload(){await this.loadSettings(),this.addSettingTab(new Se(this.app,this)),this.app.workspace.trigger("parse-style-settings"),this.stateManager=W.initialize(this),this.stateManager.createButtonsInOpenViews(),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.stateManager.createButtonsInOpenViews()})),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.stateManager.handleMetadataChanged()})),this.registerEvent(this.app.metadataCache.on("changed",()=>{this.stateManager.handleMetadataChanged()})),this.settings.toggleAutomatically&&this.registerEvent(this.app.workspace.on("file-open",()=>{this.stateManager.handleFileOpen()})),this.settings.highlightCurrentHeading&&(activeWindow.document.addEventListener("scroll",this.debounceHandler,!0),this.registerEvent(this.app.metadataCache.on("changed",()=>{let i=this.stateManager.getActiveMDView();i&&this.stateManager.getWindowInView(i).highlightCurrentHeading()}))),this.addCommand({id:"toggle-dynamic-outline",name:"Toggle for current file",checkCallback:i=>{let n=this.stateManager.getActiveMDView();return n?(i||this.stateManager.getButtonInView(n).handleClick(),!0):!1}})}onunload(){this.stateManager.removeAll(),activeWindow.document.removeEventListener("scroll",this.debounceHandler,!0)}async loadSettings(){this.settings=Object.assign({},tt,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async reloadPlugin(){let i=this.app.plugins,n=this.app.setting;i.enabledPlugins.has(ee)&&(await i.disablePlugin(ee),await i.enablePlugin(ee),await n.openTabById(ee),new re.Notice("Dynamic Outline has been reloaded"))}getCssVariableAsNumber(i,n=document.body){let s=getComputedStyle(n).getPropertyValue(i).trim(),h=parseFloat(s);return isNaN(h)?null:h}runCommand(i){this.app.commands.executeCommandById(i)}};

/* nosourcemap */